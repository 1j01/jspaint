<!DOCTYPE html>
<!-- saved from url=(0092)https://rawgit.com/brendankenny/libtess.js/gh-pages/examples/simple_triangulation/index.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Simple Triangulation</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #poly-view {
        width: 800px;
        height: 800px;
      }
    </style>

    <script src="./lib/libtess.min.js"></script>
    <script src="./src/webgl-draw.js"></script>
    <script src="./src/triangulate.js"></script>
    <script>
      /* global draw, initArrayBuffer, initWebGL, triangulate */

      var polygonFillCanvas = document.createElement("canvas");
      // var polygonOutlineCanvas = document.createElement("canvas");
      var polyViewCanvas;
      var filledMode = true;

      var NUM_VERTS = 500;
      var contours;
      var polyTriangles;

      function init() {
        polyViewCanvas = document.getElementById('poly-view');
        polygonFillCanvas.width = polyViewCanvas.width;
        polygonFillCanvas.height = polyViewCanvas.height;

        initWebGL(polygonFillCanvas);

        contours = [
          new Float32Array(generateNoisyLoop(NUM_VERTS, true, 0.8, 0.1)),
          new Float32Array(generateNoisyLoop(NUM_VERTS, false, 0.4, 10))
        ];
        
        polyTriangles = triangulate(contours);
        initArrayBuffer(polyTriangles);

        draw(filledMode);

        var polyViewCtx = polyViewCanvas.getContext("2d");
        polyViewCtx.drawImage(polygonFillCanvas, 0, 0);

        polyViewCtx.beginPath();
        polyViewCtx.scale(polygonFillCanvas.width/2, -polygonFillCanvas.height/2);
        polyViewCtx.translate(1, -1);
        for(var i=0; i<contours.length; i++){
          var contour = contours[i];
          polyViewCtx.moveTo(contour[0], contour[1]);
          for(var j=2; j<contour.length; j+=2){
            polyViewCtx.lineTo(contour[j], contour[j+1]);
          }
        }
        // polyViewCtx.closePath();
        polyViewCtx.strokeStyle = "red";
        polyViewCtx.lineWidth = 1/polygonFillCanvas.width ;
        polyViewCtx.stroke();
      }

      function generateNoisyLoop(count, ccw, radius, noiseSize) {
        var verts = new Array(count * 2);
        var thetaPer = Math.PI * 2 / count;
        var backwards = ccw ? -1 : 1;
        for (var i = 0; i < count; i++) {
          var theta = thetaPer * i * backwards;
          var randomRadius = radius * (1 + Math.random() * noiseSize);
          verts[i*2] = Math.cos(theta) * randomRadius;
          verts[i*2+1] = Math.sin(theta) * randomRadius;
        }

        return verts;
      }

      document.addEventListener('DOMContentLoaded', init, false);
    </script>
  </head>

  <body>
    <canvas id="poly-view" width="800" height="800"></canvas>
  
</body></html>